workflow:
  id: wf-brownfield-upgrade-squad
  name: Brownfield Squad Upgrade
  version: "1.0.0"
  purpose: Upgrade existing squads with safe phase reexecution and final artifact quality gates
  orchestrator: "@squad-chief"
  type: brownfield

  sequence:
    - import: "modules/module-discovery.yaml"

    - phase: baseline
      task: validate-squad
      notes: "Capture baseline score before changes"

    - phase: upgrade-plan
      task: upgrade-squad

    - phase: selective-rerun
      task: reexecute-squad-phase
      optional: true
      notes: "Use when upgrade modifies phase-critical artifacts"

    - phase: optimization
      task: optimize-workflow

    - import: "modules/module-integration.yaml"

    - import: "modules/module-quality-gates.yaml"

  checkpoints:
    - id: CP_BASELINE
      phase: baseline
      decision: CONTINUE_OR_ABORT

    - id: CP_RERUN
      phase: selective-rerun
      decision: APPROVE_RERUN

    - id: CP_FINAL
      phase: quality-final-artifacts
      decision: PASS_OR_REVISE

  outputs:
    - outputs/squad_upgrade/{squad_name}/upgrade-report.yaml
    - outputs/squad_upgrade/{squad_name}/before-after-score.yaml
